datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Team {
  id        Int      @id @default(autoincrement())
  name      String
  owner     String?
  budget    Int      @default(400)
  createdAt DateTime @default(now())

  rosters       Roster[]
  stats         TeamStatsPeriod[]
  season        TeamStatsSeason?
  financeEvents FinanceLedger[]
}


model Player {
  id          Int      @id @default(autoincrement())
  mlbId       Int?
  name        String
  posPrimary  String
  posList     String   // comma-separated for now
  createdAt   DateTime @default(now())

  rosters     Roster[]
  lots        AuctionLot[]
}

model Period {
  id        Int      @id @default(autoincrement())
  name      String
  startDate DateTime
  endDate   DateTime
  status    String   // planned, active, closed

  teamStats TeamStatsPeriod[]
}

model TeamStatsPeriod {
  id            Int      @id @default(autoincrement())
  teamId        Int
  periodId      Int
  R             Int      @default(0)
  HR            Int      @default(0)
  RBI           Int      @default(0)
  SB            Int      @default(0)
  AVG           Float    @default(0)
  W             Int      @default(0)
  SV            Int      @default(0)
  ERA           Float    @default(0)
  WHIP          Float    @default(0)
  K             Int      @default(0)
  gamesPlayed   Int      @default(0)

  team          Team     @relation(fields: [teamId], references: [id])
  period        Period   @relation(fields: [periodId], references: [id])

  @@unique([teamId, periodId])
}

model TeamStatsSeason {
  id          Int    @id @default(autoincrement())
  teamId      Int    @unique
  R           Int    @default(0)
  HR          Int    @default(0)
  RBI         Int    @default(0)
  SB          Int    @default(0)
  AVG         Float  @default(0)
  W           Int    @default(0)
  SV          Int    @default(0)
  ERA         Float  @default(0)
  WHIP        Float  @default(0)
  K           Int    @default(0)
  gamesPlayed Int    @default(0)

  team        Team   @relation(fields: [teamId], references: [id])
}

model Roster {
  id          Int      @id @default(autoincrement())
  teamId      Int
  playerId    Int
  acquiredAt  DateTime @default(now())
  releasedAt  DateTime?
  source      String
  price       Int      @default(1)

  team        Team     @relation(fields: [teamId], references: [id])
  player      Player   @relation(fields: [playerId], references: [id])
}

model AuctionLot {
  id               Int      @id @default(autoincrement())
  playerId         Int
  nominatingTeamId Int
  status           String   // idle, nominating, bidding, closing, assigned
  startTs          DateTime @default(now())
  endTs            DateTime?
  finalPrice       Int?
  winnerTeamId     Int?

  player           Player   @relation(fields: [playerId], references: [id])
}

model AuctionBid {
  id      Int      @id @default(autoincrement())
  lotId   Int
  teamId  Int
  amount  Int
  ts      DateTime @default(now())
}

model FinanceLedger {
  id      Int      @id @default(autoincrement())
  teamId  Int
  type    String   // entry_fee, bonus, il_fee, auction_adjust, etc.
  amount  Int
  reason  String?
  ts      DateTime @default(now())

  team    Team     @relation(fields: [teamId], references: [id])
}
