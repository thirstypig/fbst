# FBST Data Schemas

Source of truth for JSON produced by the stats worker and served by the FBST API.
All fields are required unless noted otherwise.

---

## 1) `GET /api/season-standings`

```ts
type SeasonStandingsResponse = {
  periodIds: number[]; // e.g. [1,2,3,4,5,6]
  rows: SeasonStandingsRow[];
};

type SeasonStandingsRow = {
  teamId: number;
  teamName: string;
  owner: string;

  // season totals
  R: number;
  HR: number;
  RBI: number;
  SB: number;
  AVG: number;
  W: number;
  S: number;
  K: number;
  ERA: number;
  WHIP: number;

  // roto points by category (1â€“N teams)
  categoryPoints: {
    R: number;
    HR: number;
    RBI: number;
    SB: number;
    AVG: number;
    W: number;
    S: number;
    K: number;
    ERA: number;
    WHIP: number;
  };

  totalPoints: number;
};
2) GET /api/period-standings?periodId=<id> (planned)
ts
Copy code
type PeriodStandingsResponse = {
  periodId: number;
  rows: PeriodStandingsRow[];
};

type PeriodStandingsRow = {
  teamId: number;
  teamName: string;
  owner: string;

  // period totals
  R: number;
  HR: number;
  RBI: number;
  SB: number;
  AVG: number;
  W: number;
  S: number;
  K: number;
  ERA: number;
  WHIP: number;

  categoryPoints: {
    R: number;
    HR: number;
    RBI: number;
    SB: number;
    AVG: number;
    W: number;
    S: number;
    K: number;
    ERA: number;
    WHIP: number;
  };

  totalPoints: number;
};
3) GET /api/players (current shape depends on server implementation)
The long-term target:

ts
Copy code
type PlayersResponse = {
  hitters: HitterRow[];
  pitchers: PitcherRow[];
};

type BasePlayerRow = {
  playerId: number;
  mlbId: string; // canonical ID (not required to show in UI)
  name: string;
  mlbTeam: string; // e.g. "LAD"
  team: string; // OGBA team name or "-" if FA
  status: "Active" | "Reserve" | "Free agent" | string;
  gamesByPos: { [pos: string]: number }; // { "C": 5, "1B": 12, ... }
};

type HitterRow = BasePlayerRow & {
  isPitcher: false;
  stats: {
    G: number;
    AB: number;
    R: number;
    H: number;
    HR: number;
    RBI: number;
    SB: number;
    AVG: number;
    GS: number;
  };
};

type PitcherRow = BasePlayerRow & {
  isPitcher: true;
  stats: {
    G: number;
    IP: number;
    ER: number;
    H: number;
    BB: number;
    SO: number;
    W: number;
    S: number;
    ERA: number;
    WHIP: number;
  };
};
4) fbst-stats-worker output: ogba_transactions_YYYY.json
Generated by: parse_onroto_transactions_html.py

ts
Copy code
type OgbaTransactionRow = {
  season: number;

  eff_date: string;        // "YYYY-MM-DD" (best-effort)
  eff_date_raw: string;    // "MM.DD"

  league: string;          // often blank in OGBA export
  team: string;            // OGBA team name, e.g. "Diamond Kings"
  player: string;          // OnRoto alias, e.g. "NArenado"
  mlb_tm: string;          // MLB team abbr, e.g. "StL"

  transaction: string;     // e.g. "Release", "Add to Actives", "Change Position to MI"

  submitted_at: string;    // "YYYY-MM-DDTHH:MM" (best-effort)
  submitted_raw: string;   // "MM.DD @ HH:MM"

  row_hash: string;        // idempotency key
};
5) DB mapping: TransactionEvent (Prisma)
Importer: server/src/scripts/import_onroto_transactions.ts

Key points:

TransactionEvent.rowHash uses row_hash from JSON for idempotent upserts.

TransactionEvent.ogbaTeamName stores raw team string even if teamId mapping fails.

TransactionEvent.playerAliasRaw stores raw player alias until it is linked via PlayerAlias.

yaml
Copy code